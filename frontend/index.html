<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë¹…ë§ˆë§ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-color: #4f46e5;
    --primary-hover: #4338ca;
    --secondary-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --bg-color: #f8fafc;
    --card-bg: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border-color: #e2e8f0;
    --hover-bg: #f1f5f9;
    --sidebar-bg: #ffffff;
    --sidebar-width: 300px;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", "Malgun Gothic", Arial, sans-serif;
    background: var(--bg-color);
    color: var(--text-primary);
    line-height: 1.6;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* ===== ë¡œê·¸ì¸ í˜ì´ì§€ ===== */
.login-page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: linear-gradient(135deg, var(--primary-color) 0%, #6366f1 100%);
}

.login-container {
    background: white;
    padding: 3rem;
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    width: 90%;
    max-width: 400px;
}

.login-container h1 {
    text-align: center;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-size: 2rem;
}

.login-container p {
    text-align: center;
    color: var(--text-secondary);
    margin-bottom: 2rem;
    font-size: 0.9375rem;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.login-form input {
    padding: 0.875rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.9375rem;
    font-family: inherit;
}

.login-form input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.login-form button {
    padding: 0.875rem;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
}

.login-form button:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.login-link {
    text-align: center;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.login-link a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
}

.login-link a:hover {
    text-decoration: underline;
}

.error-message {
    background: #fee2e2;
    color: var(--danger-color);
    padding: 0.75rem;
    border-radius: 8px;
    font-size: 0.875rem;
    text-align: center;
    margin-bottom: 1rem;
}

.main-app {
    display: none;
}

.main-app.logged-in {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.header {
    background: linear-gradient(135deg, var(--primary-color) 0%, #6366f1 100%);
    color: white;
    padding: 1rem 2rem;
    box-shadow: var(--shadow-md);
    flex-shrink: 0;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
}

.header p {
    opacity: 0.9;
    font-size: 0.875rem;
    margin: 0.25rem 0 0;
}

.header-buttons {
    display: flex;
    gap: 0.75rem;
    align-items: center;
}

.header-btn {
    padding: 0.625rem 1.25rem;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    font-family: inherit;
}

.header-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.main-container {
    display: flex;
    flex: 1;
    overflow: hidden;
}

/* ===== ì™¼ìª½ ì‚¬ì´ë“œë°” (í•™ìƒ ë¦¬ìŠ¤íŠ¸) ===== */
.sidebar {
    width: var(--sidebar-width);
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    overflow-y: hidden;
    flex-shrink: 0;
}

.sidebar-header {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}

.sidebar-header h2 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.search-filter {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.search-filter input {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    font-family: inherit;
}

.search-filter input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.search-filter select {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.875rem;
    font-family: inherit;
    background: white;
}

.search-filter select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.student-list {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;
}

.student-item {
    padding: 0.625rem 1rem;
    margin-bottom: 0.375rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid transparent;
    background: var(--hover-bg);
    display: flex;
    align-items: center;
    min-height: 2.5rem;
}

.student-item:hover {
    background: #e0e7ff;
    border-color: var(--border-color);
}

.student-item.selected {
    background: #eef2ff;
    border-color: var(--primary-color);
    color: var(--primary-color);
    font-weight: 500;
}

.student-item strong {
    display: inline;
    font-size: 0.9375rem;
}

.student-item .grade {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    opacity: 0.8;
    margin-left: 0.5rem;
}

.student-item.selected .grade {
    color: var(--primary-color);
}

.empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* ===== ì˜¤ë¥¸ìª½ ë©”ì¸ ì»¨í…ì¸  ===== */
.main-content {
    flex: 1;
    overflow-y: auto;
    padding: 0;
    display: flex;
    flex-direction: column;
}

.tabs {
    display: flex;
    background: white;
    border-bottom: 2px solid var(--border-color);
    padding: 0 1rem;
    flex-shrink: 0;
    gap: 0.5rem;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.tab {
    padding: 1rem 1.5rem;
    cursor: pointer;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.9375rem;
    font-weight: 500;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s ease;
    font-family: inherit;
}

.tab:hover {
    color: var(--primary-color);
    background: var(--hover-bg);
}

.tab.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

.tab-content {
    display: none;
    padding: 2rem;
    flex: 1;
    overflow-y: auto;
}

.tab-content.active {
    display: block;
}

.content-section {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
}

.content-section h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1.25rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--border-color);
}

.content-section h4 {
    font-size: 1rem;
    font-weight: 600;
    margin: 1rem 0 0.75rem;
    color: var(--text-primary);
}

/* ===== ì¶œì„ í˜„í™© ===== */
.attendance-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.summary-card {
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    background: var(--hover-bg);
}

.summary-card.present {
    background: #d1fae5;
    color: var(--secondary-color);
}

.summary-card.late-absent {
    background: #fee2e2;
    color: var(--danger-color);
}

.summary-card.unchecked {
    background: #f3f4f6;
    color: var(--text-secondary);
}

.summary-card .number {
    font-size: 1.75rem;
    font-weight: 700;
    display: block;
    margin-bottom: 0.25rem;
}

.summary-card .label {
    font-size: 0.8125rem;
    font-weight: 500;
}

.attendance-list {
    list-style: none;
    padding: 0;
}

.attendance-item {
    padding: 0.875rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    background: var(--hover-bg);
    border-left: 4px solid transparent;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.attendance-item.present {
    border-left-color: var(--secondary-color);
    background: #d1fae5;
}

.attendance-item.late-or-absent {
    border-left-color: var(--danger-color);
    background: #fee2e2;
}

.attendance-item.unchecked {
    border-left-color: var(--text-secondary);
}

.attendance-item strong {
    font-size: 0.9375rem;
}

.attendance-item .status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
}

.attendance-item.present .status {
    color: var(--secondary-color);
}

.attendance-item.late-or-absent .status {
    color: var(--danger-color);
}

.attendance-item.unchecked .status {
    color: var(--text-secondary);
}

.attendance-item .time-info {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
}

/* ===== í¼ ìš”ì†Œ ===== */
input, textarea, select {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.9375rem;
    font-family: inherit;
    transition: all 0.2s ease;
    background: white;
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

textarea {
    resize: vertical;
    min-height: 80px;
}

button {
    padding: 0.75rem 1rem;
    border: none;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    width: 100%;
}

.btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-secondary {
    background: var(--secondary-color);
    color: white;
}

.btn-secondary:hover {
    background: #059669;
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #dc2626;
}

button:active {
    transform: translateY(0);
}

label {
    display: block;
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.info-text {
    padding: 0.75rem;
    background: var(--hover-bg);
    border-radius: 8px;
    margin-bottom: 1rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.info-text.selected-info {
    background: #eef2ff;
    color: var(--primary-color);
    font-weight: 500;
}

.divider {
    height: 1px;
    background: var(--border-color);
    margin: 1.25rem 0;
    border: none;
}

.checkbox-group {
    display: flex;
    gap: 1rem;
    margin: 0.5rem 0;
    flex-wrap: wrap;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: normal;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
    margin: 0;
    cursor: pointer;
}

.log-item {
    background: var(--hover-bg);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    border: 1px solid var(--border-color);
}

.log-date {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.task-item {
    padding: 0.5rem;
    margin: 0.5rem 0;
    background: white;
    border-radius: 6px;
    border-left: 3px solid var(--primary-color);
}

.task-content {
    margin-top: 0.5rem;
    color: var(--text-primary);
}

.schedule-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: var(--hover-bg);
    border-radius: 8px;
}

.schedule-item label {
    font-weight: 500;
    color: var(--text-primary);
    min-width: 60px;
    margin: 0;
}

.schedule-item input[type="time"] {
    width: auto;
    margin: 0;
    flex: 1;
    max-width: 150px;
}

/* ===== ê³µìœ  ëª¨ë‹¬ ===== */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(4px);
}

.hidden {
    display: none;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    text-align: center;
    position: relative;
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-direction: column;
}

.modal-content h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-size: 1.5rem;
    border: none;
    padding: 0;
    text-align: left;
}

.modal-content form {
    text-align: left;
}

.modal-content form label {
    color: var(--text-primary);
}

.modal-content form input {
    background: white;
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.modal-content form input:focus {
    border-color: var(--primary-color);
}

.close {
    position: absolute;
    right: 1rem;
    top: 1rem;
    cursor: pointer;
    font-size: 1.75rem;
    color: var(--text-secondary);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.close:hover {
    background: var(--hover-bg);
    color: var(--text-primary);
}

.share-image {
    width: 100%;
    max-height: calc(90vh - 250px);
    object-fit: contain;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    margin: 1rem 0;
    box-shadow: var(--shadow-sm);
    display: block;
}

.hint {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-top: 1rem;
    line-height: 1.6;
    flex-shrink: 0;
}

.attendance-overview-section, .absent-students-section, .consultation-section {
    display: none;
    padding: 2rem;
    background: var(--bg-color);
    min-height: 100%;
}

.attendance-overview-section.active, .absent-students-section.active, .consultation-section.active {
    display: block;
}

/* ===== ìº˜ë¦°ë” ===== */
.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.25rem;
    margin-top: 1rem;
}

.calendar-header {
    text-align: center;
    font-weight: 600;
    font-size: 0.75rem;
    color: var(--text-secondary);
    padding: 0.375rem;
}

.calendar-day {
    min-height: 5rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
    padding: 0.25rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

.calendar-day:hover {
    background: var(--hover-bg);
    border-color: var(--primary-color);
}

.calendar-day.other-month {
    opacity: 0.4;
    background: var(--hover-bg);
}

.calendar-day.today {
    background: #eef2ff;
    border-color: var(--primary-color);
    font-weight: 600;
}

.calendar-day.selected {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.calendar-day-number {
    font-size: 0.75rem;
    margin-bottom: 0.125rem;
}

.calendar-day-events {
    width: 100%;
    text-align: left;
    font-size: 0.6rem;
    font-weight: 500;
    color: var(--primary-color);
    margin-top: 0.125rem;
    padding: 0.125rem 0.25rem;
    background: rgba(99, 102, 241, 0.1);
    border-radius: 3px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.2;
}

.consultation-item {
    background: var(--hover-bg);
    padding: 0.75rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    border-left: 3px solid var(--primary-color);
}

.consultation-item.completed {
    border-left-color: var(--secondary-color);
}

.consultation-item.cancelled {
    border-left-color: var(--danger-color);
    opacity: 0.7;
}

@media (max-width: 768px) {
    .header-top {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .header-buttons {
        width: 100%;
        flex-wrap: wrap;
    }
    
    .header-btn {
        flex: 1;
        min-width: 120px;
    }
    
    .main-container {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        max-height: 250px;
    }
    
    .header {
        padding: 1rem;
    }
    
    .header h1 {
        font-size: 1.25rem;
    }
    
    .tabs {
        overflow-x: auto;
    }
    
    .tab-content {
        padding: 1rem;
    }
}
</style>
</head>

<body>

<!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
<div id="loginPage" class="login-page">
    <div class="login-container">
        <h1>ğŸ“š ë¹…ë§ˆë§ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <p>ì„ ìƒë‹˜ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        
        <div id="loginError" class="error-message" style="display: none;"></div>
        
        <form class="login-form" id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
            <input 
                id="loginUsername" 
                type="text" 
                placeholder="ì•„ì´ë””" 
                required 
                autocomplete="username"
            />
            <input 
                id="loginPassword" 
                type="password" 
                placeholder="ë¹„ë°€ë²ˆí˜¸" 
                required 
                autocomplete="current-password"
            />
            <button type="submit">ë¡œê·¸ì¸</button>
        </form>
    </div>
</div>

<!-- ë©”ì¸ ì•± -->
<div id="mainApp" class="main-app">

<div class="header">
    <div class="header-top">
        <div>
            <h1>ğŸ“‹ ë¹…ë§ˆë§ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>í•™ìƒ ì¶œì„, ì¼ì§€, ì¼ì •ì„ í•œëˆˆì— ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>
        <div class="header-buttons">
            <span style="margin-right: 0.5rem; opacity: 0.9; font-size: 0.875rem;" id="currentTeacherName"></span>
            <button class="header-btn" onclick="openStudentRegisterModal()">ğŸ‘©â€ğŸ“ í•™ìƒ ë“±ë¡</button>
            <button class="header-btn" onclick="showAttendanceOverview()">ğŸ“Š ì˜¤ëŠ˜ ì¶œì„ í˜„í™©</button>
            <button class="header-btn" onclick="showAbsentStudents()">ğŸš¨ ë¯¸ì¶œì„ í•™ìƒ</button>
            <button class="header-btn" onclick="showConsultationManagement()">ğŸ’¬ ìƒë‹´ ê´€ë¦¬</button>
            <button class="header-btn" onclick="handleLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
</div>

<div class="main-container">
    <!-- ===== ì™¼ìª½ ì‚¬ì´ë“œë°”: í•™ìƒ ë¦¬ìŠ¤íŠ¸ ===== -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸ‘©â€ğŸ“ í•™ìƒ ëª©ë¡</h2>
            <div class="search-filter">
                <input id="searchInput" type="text" placeholder="ğŸ” ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." oninput="filterStudents()" />
                <select id="gradeFilter" onchange="filterStudents()">
                    <option value="">ì „ì²´ í•™ë…„</option>
                </select>
            </div>
        </div>
        <div class="student-list" id="studentList"></div>
    </div>

    <!-- ===== ì˜¤ë¥¸ìª½ ë©”ì¸ ì»¨í…ì¸ : ì„¸ë¶€ ì •ë³´ ===== -->
    <div class="main-content">
        <!-- íƒ­ ë°” (í•­ìƒ í‘œì‹œ) -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('attendance')">ğŸ•’ ì¶œì„ ê´€ë¦¬</button>
            <button class="tab" onclick="switchTab('tasks')">âœ… í•  ì¼ ê´€ë¦¬</button>
            <button class="tab" onclick="switchTab('log')">ğŸ“˜ ì¼ì§€ ê´€ë¦¬</button>
            <button class="tab" onclick="switchTab('schedule')">ğŸ“… ë“±ì› ì‹œê°„</button>
        </div>

        <!-- í•™ìƒì´ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ -->
        <div id="noSelection" class="tab-content active" style="display: flex; align-items: center; justify-content: center; text-align: center; padding: 3rem;">
            <div>
                <p style="font-size: 1.125rem; color: var(--text-secondary);">
                    ğŸ‘ˆ ì™¼ìª½ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ì‹œë©´<br/>ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </p>
            </div>
        </div>

        <!-- í•™ìƒì´ ì„ íƒë˜ì—ˆì„ ë•Œ í‘œì‹œ -->
        <div id="studentDetails" style="display: none;">

            <!-- ì¶œì„ ê´€ë¦¬ íƒ­ -->
            <div id="tab-attendance" class="tab-content active">
                <div class="content-section">
                    <h3>ğŸ•’ ì¶œì„ ê´€ë¦¬</h3>
                    
                    <p id="attendanceStudentText" class="info-text">í•™ìƒ ì •ë³´</p>

                    <label>ë“±ì› ì‹œê°„</label>
                    <input id="checkIn" type="time" />

                    <label>í•˜ì› ì‹œê°„</label>
                    <input id="checkOut" type="time" />

                    <button class="btn-primary" onclick="submitAttendance()">ì¶œì„ ì €ì¥</button>

                    <hr class="divider" />
                    <h4>ğŸ“Š ì˜¤ëŠ˜ ì¶œì„ í˜„í™©</h4>
                    
                    <div id="attendanceSummary" class="attendance-summary"></div>
                    <ul id="attendanceList" class="attendance-list"></ul>
                </div>
            </div>

            <!-- í•  ì¼ ê´€ë¦¬ íƒ­ -->
            <div id="tab-tasks" class="tab-content">
                <div class="content-section">
                    <h3>âœ… í•  ì¼ ê´€ë¦¬</h3>
                    
                    <label>ë‚ ì§œ</label>
                    <input id="taskDate" type="date" onchange="loadTasksForDate()" />

                    <label>í•  ì¼ ì¶”ê°€ (í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥)</label>
                    <textarea id="taskInput" placeholder="ì˜ˆ:&#10;ìˆ˜í•™ ë¬¸ì œì§‘ 10í˜ì´ì§€&#10;ì˜ì–´ ë‹¨ì–´ ì•”ê¸°&#10;ê³¼í•™ ì‹¤í—˜ ë³´ê³ ì„œ"></textarea>

                    <button class="btn-primary" onclick="addTasks()">í•  ì¼ ì¶”ê°€</button>

                    <hr class="divider" />
                    <h4 id="tasksListTitle">í•  ì¼ ëª©ë¡</h4>
                    <ul id="tasksList"></ul>
                </div>
            </div>

            <!-- ì¼ì§€ ê´€ë¦¬ íƒ­ -->
            <div id="tab-log" class="tab-content">
                <div class="content-section">
                    <h3>ğŸ“˜ ì¼ì§€ ê´€ë¦¬</h3>

                    <label>ë‚ ì§œ</label>
                    <input id="logDate" type="date" onchange="loadLogForDate()" />

                    <hr class="divider" />
                    <h4>í•  ì¼ ëª©ë¡ (ìë™ ë¶ˆëŸ¬ì˜¤ê¸°)</h4>
                    <div id="logTasksList" style="min-height: 100px; padding: 1rem; background: var(--hover-bg); border-radius: 8px; margin-bottom: 1rem;"></div>

                    <label>ì¶œê²° ìƒíƒœ (ìë™ ë¶ˆëŸ¬ì˜¤ê¸°)</label>
                    <select id="logAttendanceStatus" disabled>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ì¶œì„">âœ… ì¶œì„</option>
                        <option value="ì§€ê°">â° ì§€ê°</option>
                        <option value="ê²°ì„">âŒ ê²°ì„</option>
                    </select>

                    <label>ì„ ìƒë‹˜ ë©”ëª¨</label>
                    <textarea id="teacherNote" placeholder="ì˜¤ëŠ˜ ìˆ˜ì—… ë‚´ìš©, íŠ¹ì´ì‚¬í•­ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”"></textarea>

                    <label>ì§€ê°/ê²°ì„ ì‚¬ìœ </label>
                    <textarea id="absenceReason" placeholder="ì§€ê° ë˜ëŠ” ê²°ì„ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>

                    <label>í›„ì† ì¡°ì¹˜</label>
                    <textarea id="followUpAction" placeholder="ì „í™”, ë¬¸ì, ìƒë‹´ ë“± í›„ì† ì¡°ì¹˜ ë‚´ìš©"></textarea>

                    <label>ë³´ê°• ë‚´ìš©</label>
                    <textarea id="makeupClassNote" placeholder="ì˜ˆ: 4/3 ëª©ìš”ì¼ ì˜¤í›„ 6ì‹œ"></textarea>

                    <label>ì‹œí—˜ ê²°ê³¼</label>
                    <textarea id="examResult" placeholder="ì‹œí—˜ ê²°ê³¼ ìš”ì•½ (ì ìˆ˜, ë“±ìˆ˜, íŠ¹ì´ì‚¬í•­ ë“±)"></textarea>

                    <button class="btn-primary" onclick="createDailyLog()">ğŸ’¾ ì¼ì§€ ì €ì¥</button>

                    <hr class="divider" />
                    <h4>ì‘ì„±ëœ ì¼ì§€</h4>
                    <ul id="logList"></ul>
                </div>
            </div>

            <!-- ë“±ì› ì‹œê°„ íƒ­ -->
            <div id="tab-schedule" class="tab-content">
                <div class="content-section">
                    <h3>ğŸ“… ìš”ì¼ë³„ ë“±ì› ì‹œê°„</h3>
                    <ul id="scheduleList"></ul>
                </div>
            </div>
        </div>

        <!-- ì˜¤ëŠ˜ ì¶œì„ í˜„í™© ì „ì²´ ë³´ê¸° ì„¹ì…˜ -->
        <div id="attendanceOverviewSection" class="attendance-overview-section">
            <div class="content-section">
                <h3>ğŸ“Š ì˜¤ëŠ˜ ì¶œì„ í˜„í™©</h3>
                <div id="attendanceOverviewSummary" class="attendance-summary"></div>
                <ul id="attendanceOverviewList" class="attendance-list"></ul>
            </div>
        </div>

        <!-- ë¯¸ì¶œì„ í•™ìƒ ì „ì²´ ë³´ê¸° ì„¹ì…˜ -->
        <div id="absentStudentsSection" class="absent-students-section">
            <div class="content-section">
                <h3>ğŸš¨ ë¯¸ì¶œì„ í•™ìƒ</h3>
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <button class="btn-secondary" onclick="loadAbsentStudents()" style="flex: 1;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn-danger" onclick="sendSelectedSMS()" style="flex: 1;">ğŸ“± ì„ íƒ ë¬¸ì ë°œì†¡</button>
                </div>
                <ul id="absentList" class="attendance-list"></ul>
            </div>
        </div>

        <!-- ìƒë‹´ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="consultationSection" class="consultation-section">
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <button class="btn-primary" onclick="openConsultationModal()" style="width: auto;">â• ìƒë‹´ ë“±ë¡</button>
                <button class="btn-secondary" onclick="loadConsultations()" style="width: auto;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 1.5rem;">
                <!-- ìº˜ë¦°ë” -->
                <div class="content-section">
                    <h3>ğŸ“… ìƒë‹´ ì¼ì • ìº˜ë¦°ë”</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <button onclick="changeMonth(-1)" style="padding: 0.5rem 1rem; background: var(--hover-bg); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer;">â—€ ì´ì „</button>
                        <h4 id="calendarMonth" style="margin: 0;"></h4>
                        <button onclick="changeMonth(1)" style="padding: 0.5rem 1rem; background: var(--hover-bg); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer;">ë‹¤ìŒ â–¶</button>
                    </div>
                    <div id="consultationCalendar" class="calendar"></div>
                </div>
                
                <!-- ì„ íƒëœ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ -->
                <div class="content-section" style="max-height: calc(100vh - 250px); overflow-y: auto;">
                    <h3 id="selectedDateTitle" style="font-size: 1rem;">ğŸ“‹ ìƒë‹´ ëª©ë¡</h3>
                    <ul id="consultationList" style="list-style: none; padding: 0;"></ul>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <button class="btn-secondary" onclick="selectedConsultationDate = null; renderConsultationList();" style="width: 100%; padding: 0.5rem; font-size: 0.875rem;">
                            ì „ì²´ ì˜ˆì • ìƒë‹´ ë³´ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- ë©”ì¸ ì•± ì¢…ë£Œ -->

<script>
// API URL ì„¤ì •
// - ê°œë°œ í™˜ê²½: "http://127.0.0.1:8000/api"
// - í”„ë¡œë•ì…˜ (ê°™ì€ ì„œë²„): window.location.origin + "/api"
// - í”„ë¡œë•ì…˜ (ë³„ë„ ì„œë²„): "http://your-server-ip:8000/api"
const API = window.location.origin.includes("127.0.0.1") || window.location.origin.includes("localhost") 
    ? "http://127.0.0.1:8000/api" 
    : (window.location.origin + "/api");
let selectedStudent = null;
let allStudents = [];
let filteredStudents = [];
let currentToken = null;
let currentTeacher = null;

// =========================
// ì¸ì¦ ê´€ë ¨
// =========================
function getToken() {
    return localStorage.getItem('auth_token');
}

function setToken(token) {
    localStorage.setItem('auth_token', token);
}

function removeToken() {
    localStorage.removeItem('auth_token');
}

function getAuthHeaders() {
    const token = getToken();
    return {
        'Content-Type': 'application/json',
        ...(token ? { 'Authorization': `Bearer ${token}` } : {})
    };
}

async function checkAuth() {
    const token = getToken();
    if (!token) {
        return false;
    }

    try {
        const res = await fetch(`${API}/auth/me?token=${encodeURIComponent(token)}`);
        if (res.ok) {
            currentTeacher = await res.json();
            return true;
        } else {
            // ì¸ì¦ ì‹¤íŒ¨ ì‹œ í† í° ì œê±°
            removeToken();
        }
    } catch (error) {
        console.error("ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:", error);
        removeToken();
    }
    
    return false;
}

function showLoginPage() {
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('mainApp').classList.remove('logged-in');
    currentToken = null;
    currentTeacher = null;
}

function showMainApp() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('mainApp').classList.add('logged-in');
    if (currentTeacher) {
        document.getElementById('currentTeacherName').textContent = 'ë¹…ë§ˆë§ˆ ì„ ìƒë‹˜';
    }
}

async function handleLogin() {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    const errorDiv = document.getElementById('loginError');

    errorDiv.style.display = 'none';

    if (!username || !password) {
        errorDiv.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        errorDiv.style.display = 'block';
        return;
    }

    try {
        const res = await fetch(`${API}/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        if (res.ok) {
            const data = await res.json();
            setToken(data.token);
            currentToken = data.token;
            currentTeacher = {
                teacher_name: data.teacher_name,
                username: data.username
            };
            showMainApp();
            initializeApp();
        } else {
            const errorData = await res.json().catch(() => ({ detail: 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' }));
            errorDiv.textContent = errorData.detail || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
        errorDiv.textContent = 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        errorDiv.style.display = 'block';
    }
}

async function handleLogout() {
    const token = getToken();
    if (token) {
        try {
            await fetch(`${API}/auth/logout?token=${encodeURIComponent(token)}`, {
                method: 'POST'
            });
        } catch (error) {
            console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
        }
    }
    
    removeToken();
    currentToken = null;
    currentTeacher = null;
    showLoginPage();
}

async function initializeApp() {
    // ë¡œê·¸ì¸ í›„ ì•± ì´ˆê¸°í™”
    await loadStudents();
    loadAbsentStudents();
    loadAttendanceToday();
    document.getElementById("logDate").value = new Date().toISOString().slice(0, 10);
    const taskDateInput = document.getElementById("taskDate");
    if (taskDateInput) {
        taskDateInput.value = new Date().toISOString().slice(0, 10);
    }
    
    // ìƒë‹´ì€ ì´ì œ í•™ìƒ ì´ë¦„ê³¼ í•™ë…„ì„ ì§ì ‘ ì…ë ¥í•˜ëŠ” ë°©ì‹
}

// ìƒë‹´ ëª¨ë‹¬ì˜ í•™ìƒ ì„ íƒ ì˜µì…˜ ì±„ìš°ê¸°
function populateConsultationStudentOptions() {
    const select = document.getElementById("consultationStudentId");
    select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
    
    allStudents.forEach(student => {
        const option = document.createElement('option');
        option.value = student.id;
        option.textContent = `${student.name} (${student.grade})`;
        select.appendChild(option);
    });
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸
(async function() {
    const isAuthenticated = await checkAuth();
    if (isAuthenticated) {
        showMainApp();
        initializeApp();
    } else {
        showLoginPage();
    }
})();

const WEEKDAYS = [
    { value: 0, label: "ì›”" },
    { value: 1, label: "í™”" },
    { value: 2, label: "ìˆ˜" },
    { value: 3, label: "ëª©" },
    { value: 4, label: "ê¸ˆ" },
    { value: 5, label: "í† " },
    { value: 6, label: "ì¼" }
];

// =========================
// íƒ­ ì „í™˜
// =========================
function switchTab(tabName) {
    // í•™ìƒì´ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•ŒëŠ” ì„ íƒ ë©”ì‹œì§€ë§Œ í‘œì‹œ
    if (!selectedStudent) {
        // ëª¨ë“  íƒ­ê³¼ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // ì„ íƒëœ íƒ­ í™œì„±í™”
        if (event && event.target) {
            event.target.classList.add('active');
        }
        
        // noSelection ë©”ì‹œì§€ í‘œì‹œ
        document.getElementById("noSelection").style.display = "flex";
        document.getElementById("noSelection").classList.add("active");
        document.getElementById("studentDetails").style.display = "none";
        return;
    }
    
    // ëª¨ë“  íƒ­ê³¼ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    // í•™ìƒ ìƒì„¸ ì •ë³´ í‘œì‹œ
    document.getElementById("noSelection").style.display = "none";
    document.getElementById("noSelection").classList.remove("active");
    document.getElementById("studentDetails").style.display = "block";
    document.getElementById(`tab-${tabName}`).classList.add('active');
    
    // ì¶œì„ í˜„í™©/ë¯¸ì¶œì„ í•™ìƒ/ìƒë‹´ ê´€ë¦¬ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
    document.getElementById("attendanceOverviewSection").classList.remove("active");
    document.getElementById("absentStudentsSection").classList.remove("active");
    document.getElementById("consultationSection").classList.remove("active");
}

// =========================
// ìƒë‹´ ê´€ë¦¬ í‘œì‹œ
// =========================
function showConsultationManagement() {
    // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
    document.getElementById("noSelection").style.display = "none";
    document.getElementById("noSelection").classList.remove("active");
    document.getElementById("studentDetails").style.display = "none";
    document.getElementById("attendanceOverviewSection").classList.remove("active");
    document.getElementById("absentStudentsSection").classList.remove("active");
    document.getElementById("consultationSection").classList.add("active");
    
    // ìƒë‹´ ëª©ë¡ ë° ìº˜ë¦°ë” ë¡œë“œ
    loadConsultations();
}

// =========================
// í•™ìƒ ëª©ë¡ ì •ë ¬ (í•™ë…„ìˆœ: ì´ˆ1~ì´ˆ6, ì¤‘1~ì¤‘3, ê³ 1~ê³ 3, ê°™ì€ í•™ë…„ì´ë©´ ê°€ë‚˜ë‹¤)
// =========================
function sortStudents(students) {
    // í•™ë…„ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function getGradeOrder(grade) {
        const gradeStr = grade.toLowerCase().trim();
        
        // ì´ˆë“±í•™êµ: ì´ˆ1 ~ ì´ˆ6 -> 1 ~ 6
        if (gradeStr.startsWith('ì´ˆ')) {
            const num = parseInt(gradeStr.replace('ì´ˆ', '').trim());
            return isNaN(num) ? 999 : num;
        }
        
        // ì¤‘í•™êµ: ì¤‘1 ~ ì¤‘3 -> 7 ~ 9
        if (gradeStr.startsWith('ì¤‘')) {
            const num = parseInt(gradeStr.replace('ì¤‘', '').trim());
            return isNaN(num) ? 999 : 6 + num;
        }
        
        // ê³ ë“±í•™êµ: ê³ 1 ~ ê³ 3 -> 10 ~ 12
        if (gradeStr.startsWith('ê³ ')) {
            const num = parseInt(gradeStr.replace('ê³ ', '').trim());
            return isNaN(num) ? 999 : 9 + num;
        }
        
        // ì•Œ ìˆ˜ ì—†ëŠ” í•™ë…„ì€ ë§¨ ë’¤ë¡œ
        return 999;
    }
    
    return students.sort((a, b) => {
        const orderA = getGradeOrder(a.grade);
        const orderB = getGradeOrder(b.grade);
        
        // í•™ë…„ ìˆœì„œê°€ ë‹¤ë¥´ë©´ í•™ë…„ìœ¼ë¡œ ì •ë ¬
        if (orderA !== orderB) {
            return orderA - orderB;
        }
        
        // ê°™ì€ í•™ë…„ì´ë©´ ì´ë¦„ ê°€ë‚˜ë‹¤ìˆœ
        return a.name.localeCompare(b.name, 'ko');
    });
}

// =========================
// í•™ìƒ ëª©ë¡ ë¡œë“œ
// =========================
async function loadStudents() {
    const res = await fetch(`${API}/students/`);
    allStudents = await res.json();
    
    // í•™ë…„ ëª©ë¡ ì¶”ì¶œ ë° í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
    const grades = [...new Set(allStudents.map(s => s.grade))].sort();
    const gradeFilter = document.getElementById("gradeFilter");
    const currentValue = gradeFilter.value;
    
    // ê¸°ì¡´ ì˜µì…˜ ìœ ì§€ (ì „ì²´ í•™ë…„ ì œì™¸)
    gradeFilter.innerHTML = '<option value="">ì „ì²´ í•™ë…„</option>';
    grades.forEach(grade => {
        const option = document.createElement('option');
        option.value = grade;
        option.textContent = grade;
        gradeFilter.appendChild(option);
    });
    
    // ì´ì „ í•„í„° ê°’ ë³µì›
    if (currentValue) {
        gradeFilter.value = currentValue;
    }
    
    filterStudents();
}

// =========================
// í•™ìƒ í•„í„°ë§
// =========================
function filterStudents() {
    const searchText = document.getElementById("searchInput").value.toLowerCase().trim();
    const gradeFilter = document.getElementById("gradeFilter").value;
    
    filteredStudents = allStudents.filter(student => {
        const matchesSearch = !searchText || student.name.toLowerCase().includes(searchText);
        const matchesGrade = !gradeFilter || student.grade === gradeFilter;
        return matchesSearch && matchesGrade;
    });
    
    // ì •ë ¬
    filteredStudents = sortStudents(filteredStudents);
    
    // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    renderStudentList();
}

// =========================
// í•™ìƒ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
// =========================
function renderStudentList() {
    const list = document.getElementById("studentList");
    list.innerHTML = "";

    if (filteredStudents.length === 0) {
        list.innerHTML = '<div class="empty-state">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
    }

    filteredStudents.forEach(s => {
        const div = document.createElement("div");
        div.className = "student-item";
        if (selectedStudent && s.id === selectedStudent.id) {
            div.classList.add("selected");
        }
        div.innerHTML = `
            <div>
                <strong>${s.name}</strong>
                <span class="grade">${s.grade}</span>
            </div>
        `;
        div.onclick = () => selectStudent(s, div);
        list.appendChild(div);
    });
}

// =========================
// í•™ìƒ ì„ íƒ
// =========================
function selectStudent(student, element) {
    selectedStudent = student;

    document.querySelectorAll(".student-item").forEach(x =>
        x.classList.remove("selected"));
    element.classList.add("selected");

    // í•™ìƒ ìƒì„¸ ì •ë³´ í‘œì‹œ
    document.getElementById("noSelection").style.display = "none";
    document.getElementById("noSelection").classList.remove("active");
    document.getElementById("studentDetails").style.display = "block";
    document.getElementById("attendanceOverviewSection").classList.remove("active");
    document.getElementById("absentStudentsSection").classList.remove("active");
    document.getElementById("consultationSection").classList.remove("active");

    // ì¼ì§€ì˜ ì¶œê²° ìƒíƒœ ì„ íƒ í™œì„±í™”
    document.getElementById("logAttendanceStatus").disabled = false;

    // ì²« ë²ˆì§¸ íƒ­ í™œì„±í™”
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    document.querySelector('.tab').classList.add('active');
    document.getElementById('tab-attendance').classList.add('active');

    loadAttendanceToday();
    loadDailyLogs();
    loadStudentSchedules();
    loadStudentAttendance(); // ì´ í•¨ìˆ˜ì—ì„œ í•™ìƒ ì •ë³´ì™€ ë“±ì› ì˜ˆì • ì‹œê°„ í‘œì‹œ
    loadInitialLogData(); // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì¼ì§€ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    
    // í•  ì¼ ê´€ë¦¬ íƒ­ ì´ˆê¸°í™” (ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •)
    const taskDateInput = document.getElementById("taskDate");
    if (taskDateInput) {
        taskDateInput.value = new Date().toISOString().slice(0, 10);
        loadTasksForDate();
    }
}

// =========================
// í•™ìƒ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
// =========================
function openStudentRegisterModal() {
    document.getElementById("studentRegisterModal").classList.remove("hidden");
    // í¼ ì´ˆê¸°í™”
    document.getElementById("modalStudentName").value = "";
    document.getElementById("modalStudentGrade").value = "";
    document.getElementById("modalParentPhone").value = "";
}

// =========================
// í•™ìƒ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
// =========================
function closeStudentRegisterModal() {
    document.getElementById("studentRegisterModal").classList.add("hidden");
}

// =========================
// í•™ìƒ ìƒì„±
// =========================
async function createStudent() {
    const nameInput = document.getElementById("modalStudentName");
    const gradeInput = document.getElementById("modalStudentGrade");
    const phoneInput = document.getElementById("modalParentPhone");
    
    if (!nameInput.value.trim() || !gradeInput.value.trim()) {
        alert("ì´ë¦„ê³¼ í•™ë…„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }
    
    try {
        await fetch(`${API}/students/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: nameInput.value.trim(),
                grade: gradeInput.value.trim(),
                parent_phone: phoneInput.value.trim() || null
            })
        });
        nameInput.value = "";
        gradeInput.value = "";
        phoneInput.value = "";
        await loadStudents(); // í•™ìƒ ëª©ë¡ ì—…ë°ì´íŠ¸
        closeStudentRegisterModal();
        alert("í•™ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } catch (error) {
        alert("í•™ìƒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

// =========================
// ì˜¤ëŠ˜ ì¶œì„ í˜„í™© ì „ì²´ ë³´ê¸°
// =========================
function showAttendanceOverview() {
    // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
    document.getElementById("noSelection").style.display = "none";
    document.getElementById("noSelection").classList.remove("active");
    document.getElementById("studentDetails").style.display = "none";
    document.getElementById("absentStudentsSection").classList.remove("active");
    document.getElementById("attendanceOverviewSection").classList.add("active");
    
    // ì¶œì„ í˜„í™© ë¡œë“œ
    loadAttendanceOverview();
}

// =========================
// ì˜¤ëŠ˜ ì¶œì„ í˜„í™© ì „ì²´ ë³´ê¸° ë¡œë“œ
// =========================
async function loadAttendanceOverview() {
    const res = await fetch(`${API}/attendance/today`);
    const data = await res.json();
    const list = document.getElementById("attendanceOverviewList");
    const summary = document.getElementById("attendanceOverviewSummary");
    
    list.innerHTML = "";
    
    // ìš”ì•½ í‘œì‹œ
    if (data.summary) {
        summary.innerHTML = `
            <div class="summary-card present">
                <span class="number">${data.summary.present}</span>
                <span class="label">ì¶œì„</span>
            </div>
            <div class="summary-card late-absent">
                <span class="number">${data.summary.late_or_absent}</span>
                <span class="label">ì§€ê°/ê²°ì„</span>
            </div>
            <div class="summary-card unchecked">
                <span class="number">${data.summary.unchecked}</span>
                <span class="label">ë¯¸í™•ì¸</span>
            </div>
        `;
    }

    if (data.students.length === 0) {
        list.innerHTML = '<li class="empty-state">ì˜¤ëŠ˜ ì¶œì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</li>';
        return;
    }

    data.students.forEach(s => {
        const li = document.createElement("li");
        li.className = `attendance-item ${s.status}`;
        
        let statusText = '';
        let statusIcon = '';
        let isLate = false;
        
        // ì˜ˆì • ì‹œê°„ë³´ë‹¤ ëŠ¦ê²Œ ë“±ì›í•œ ê²½ìš° í™•ì¸
        if (s.status === 'present' && s.check_in && s.expected_time) {
            const checkInTime = s.check_in.split(':').map(Number);
            const expectedTime = s.expected_time.split(':').map(Number);
            const checkInMinutes = checkInTime[0] * 60 + checkInTime[1];
            const expectedMinutes = expectedTime[0] * 60 + expectedTime[1];
            isLate = checkInMinutes > expectedMinutes;
        }
        
        if (s.status === 'present') {
            statusText = isLate ? 'ì¶œì„(ì§€ê°)' : 'ì¶œì„';
            statusIcon = isLate ? 'âš ï¸' : 'âœ…';
        } else if (s.status === 'late_or_absent') {
            statusText = 'ì§€ê°/ê²°ì„';
            statusIcon = 'âš ï¸';
        } else {
            statusText = 'ë¯¸í™•ì¸';
            statusIcon = 'â³';
        }

        let timeInfo = '';
        if (s.check_in) {
            timeInfo = `<div class="time-info">ë“±ì›: ${s.check_in}</div>`;
        } else if (s.expected_time) {
            timeInfo = `<div class="time-info">ì˜ˆì •: ${s.expected_time}</div>`;
        }

        li.innerHTML = `
            <div>
                <strong>${s.name}</strong>
                ${timeInfo}
            </div>
            <div class="status">
                ${statusIcon} ${statusText}
            </div>
        `;
        list.appendChild(li);
    });
}

// =========================
// ë¯¸ì¶œì„ í•™ìƒ ì „ì²´ ë³´ê¸°
// =========================
function showAbsentStudents() {
    // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
    document.getElementById("noSelection").style.display = "none";
    document.getElementById("noSelection").classList.remove("active");
    document.getElementById("studentDetails").style.display = "none";
    document.getElementById("attendanceOverviewSection").classList.remove("active");
    document.getElementById("absentStudentsSection").classList.add("active");
    
    // ë¯¸ì¶œì„ í•™ìƒ ë¡œë“œ
    loadAbsentStudents();
}

// =========================
// ì¶œì„ ì €ì¥
// =========================
async function submitAttendance() {
    if (!selectedStudent) {
        alert("âš ï¸ í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }

    try {
        const checkIn = document.getElementById("checkIn").value;
        const checkOut = document.getElementById("checkOut").value;
        
        // ë“±ì› ì‹œê°„ì´ ìˆìœ¼ë©´ ì¶œì„, ì—†ìœ¼ë©´ ê²°ì„ìœ¼ë¡œ ê°„ì£¼
        const status = checkIn ? "present" : "absent";
        
        // check_inê³¼ check_outì´ ë¹ˆ ë¬¸ìì—´ì´ë©´ nullë¡œ ë³€í™˜
        // íƒ€ì„ì¡´ ë¬¸ì œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë¡œì»¬ ë‚ ì§œë¥¼ ì§ì ‘ ê³„ì‚°
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayStr = `${year}-${month}-${day}`;
        
        const payload = {
            student_id: selectedStudent.id,
            date: todayStr,
            status: status,
            check_in: checkIn && checkIn.trim() ? checkIn.trim() : null,
            check_out: checkOut && checkOut.trim() ? checkOut.trim() : null
        };
        
        // ë””ë²„ê¹…: ì „ì†¡í•˜ëŠ” ë°ì´í„° í™•ì¸
        console.log("DEBUG: ì¶œì„ ì €ì¥ ìš”ì²­ ë°ì´í„°:", payload);
        console.log("DEBUG: checkIn ì›ë³¸ ê°’:", checkIn, "íƒ€ì…:", typeof checkIn);

        const response = await fetch(`${API}/attendance/`, {
            method: "POST",
            headers: getAuthHeaders(),
            body: JSON.stringify(payload)
        });
        
        // ë””ë²„ê¹…: ì‘ë‹µ ë°ì´í„° í™•ì¸
        const responseData = await response.json();
        console.log("DEBUG: ì¶œì„ ì €ì¥ ì‘ë‹µ ë°ì´í„°:", responseData);

        if (!response.ok) {
            const errorText = await response.text();
            console.error("ì¶œì„ ì €ì¥ ì‹¤íŒ¨ ì‘ë‹µ:", errorText);
            throw new Error(errorText || "ì¶œì„ ì €ì¥ ì‹¤íŒ¨");
        }

        // ì¶œì„ ì €ì¥ í›„ ìë™ ì—…ë°ì´íŠ¸
        await loadAttendanceToday();
        await loadStudentAttendance();
        await loadAttendanceOverview(); // ì „ì²´ ì¶œì„ í˜„í™©ë„ ì—…ë°ì´íŠ¸
        await loadAbsentStudents(); // ë¯¸ì¶œì„ í•™ìƒ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
        
        // ì…ë ¥ í•„ë“œëŠ” ì¶œì„ ê¸°ë¡ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì±„ì›Œì§ (loadStudentAttendanceì—ì„œ ì²˜ë¦¬)
        alert("ì¶œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } catch (error) {
        console.error("ì¶œì„ ì €ì¥ ì‹¤íŒ¨:", error);
        const errorMessage = error.message || "ì¶œì„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        alert(`ì¶œì„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜ ë‚´ìš©: ${errorMessage}`);
    }
}

// =========================
// ì˜¤ëŠ˜ ì¶œì„ í˜„í™© (ì „ì²´)
// =========================
async function loadAttendanceToday() {
    const res = await fetch(`${API}/attendance/today`);
    const data = await res.json();
    const list = document.getElementById("attendanceList");
    const summary = document.getElementById("attendanceSummary");
    
    list.innerHTML = "";
    
    // ìš”ì•½ í‘œì‹œ
    if (data.summary) {
        summary.innerHTML = `
            <div class="summary-card present">
                <span class="number">${data.summary.present}</span>
                <span class="label">ì¶œì„</span>
            </div>
            <div class="summary-card late-absent">
                <span class="number">${data.summary.late_or_absent}</span>
                <span class="label">ì§€ê°/ê²°ì„</span>
            </div>
            <div class="summary-card unchecked">
                <span class="number">${data.summary.unchecked}</span>
                <span class="label">ë¯¸í™•ì¸</span>
            </div>
        `;
    }

    if (data.students.length === 0) {
        list.innerHTML = '<li class="empty-state">ì˜¤ëŠ˜ ì¶œì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</li>';
        return;
    }

    data.students.forEach(s => {
        const li = document.createElement("li");
        li.className = `attendance-item ${s.status}`;
        
        // ìƒíƒœì— ë”°ë¥¸ í…ìŠ¤íŠ¸ ë° ì•„ì´ì½˜
        let statusText = '';
        let statusIcon = '';
        let isLate = false;
        
        // ì˜ˆì • ì‹œê°„ë³´ë‹¤ ëŠ¦ê²Œ ë“±ì›í•œ ê²½ìš° í™•ì¸
        if (s.status === 'present' && s.check_in && s.expected_time) {
            const checkInTime = s.check_in.split(':').map(Number);
            const expectedTime = s.expected_time.split(':').map(Number);
            const checkInMinutes = checkInTime[0] * 60 + checkInTime[1];
            const expectedMinutes = expectedTime[0] * 60 + expectedTime[1];
            isLate = checkInMinutes > expectedMinutes;
        }
        
        if (s.status === 'present') {
            statusText = isLate ? 'ì¶œì„(ì§€ê°)' : 'ì¶œì„';
            statusIcon = isLate ? 'âš ï¸' : 'âœ…';
        } else if (s.status === 'late_or_absent') {
            statusText = 'ì§€ê°/ê²°ì„';
            statusIcon = 'âš ï¸';
        } else {
            statusText = 'ë¯¸í™•ì¸';
            statusIcon = 'â³';
        }

        // ì‹œê°„ ì •ë³´
        let timeInfo = '';
        if (s.check_in) {
            timeInfo = `<div class="time-info">ë“±ì›: ${s.check_in}</div>`;
        } else if (s.expected_time) {
            timeInfo = `<div class="time-info">ì˜ˆì •: ${s.expected_time}</div>`;
        }

        li.innerHTML = `
            <div>
                <strong>${s.name}</strong>
                ${timeInfo}
            </div>
            <div class="status">
                ${statusIcon} ${statusText}
            </div>
        `;
        list.appendChild(li);
    });
}

// =========================
// ì„ íƒëœ í•™ìƒì˜ ì¶œì„ ê¸°ë¡
// =========================
async function loadStudentAttendance() {
    if (!selectedStudent) return;
    
    try {
        // ì˜¤ëŠ˜ ì¶œì„ ê¸°ë¡ ë¡œë“œ
        const res = await fetch(`${API}/attendance/student/${selectedStudent.id}`);
        const records = await res.json();
        
        // ì˜¤ëŠ˜ ë“±ì› ì˜ˆì • ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
        const today = new Date();
        // JavaScript: getDay() -> 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
        // Python weekday(): 0=ì›”ìš”ì¼, 1=í™”ìš”ì¼, ..., 6=ì¼ìš”ì¼
        const jsDay = today.getDay();
        const weekday = jsDay === 0 ? 6 : jsDay - 1; // ë³€í™˜: 0(ì¼) -> 6, 1(ì›”) -> 0, ..., 6(í† ) -> 5
        const scheduleRes = await fetch(`${API}/students/${selectedStudent.id}/schedules/`);
        const schedules = await scheduleRes.json();
        const todaySchedule = schedules.find(s => s.weekday === weekday);
        const expectedTime = todaySchedule ? todaySchedule.expected_time : null;
        
        // í•™ìƒ ì •ë³´ í‘œì‹œ (ë“±ì› ì˜ˆì • ì‹œê°„ í¬í•¨)
        let studentInfo = `<span class="selected-info">ì„ íƒëœ í•™ìƒ: <strong>${selectedStudent.name}</strong> (${selectedStudent.grade})</span>`;
        if (expectedTime) {
            studentInfo += `<br/><span style="color: var(--text-secondary); font-size: 0.875rem;">â° ì˜¤ëŠ˜ ë“±ì› ì˜ˆì •: ${expectedTime}</span>`;
        }
        document.getElementById("attendanceStudentText").innerHTML = studentInfo;
        document.getElementById("attendanceStudentText").classList.add("selected-info");
        
        // ì˜¤ëŠ˜ ì¶œì„ ê¸°ë¡ì´ ìˆìœ¼ë©´ í¼ì— í‘œì‹œ
        // íƒ€ì„ì¡´ ë¬¸ì œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë¡œì»¬ ë‚ ì§œë¥¼ ì§ì ‘ ê³„ì‚°
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayStr = `${year}-${month}-${day}`;
        const todayRecord = records.find(r => r.date === todayStr);
        
        if (todayRecord) {
            if (todayRecord.check_in) {
                document.getElementById("checkIn").value = todayRecord.check_in;
            } else {
                document.getElementById("checkIn").value = "";
            }
            if (todayRecord.check_out) {
                document.getElementById("checkOut").value = todayRecord.check_out;
            } else {
                document.getElementById("checkOut").value = "";
            }
        } else {
            document.getElementById("checkIn").value = "";
            document.getElementById("checkOut").value = "";
        }
    } catch (error) {
        console.error("ì¶œì„ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
    }
}

// =========================
// ë‚ ì§œë³„ í•  ì¼ ë¡œë“œ
// =========================
async function loadTasksForDate() {
    if (!selectedStudent) return;
    
    const taskDateInput = document.getElementById("taskDate");
    if (!taskDateInput) return;
    
    const selectedDate = taskDateInput.value;
    if (!selectedDate) return;
    
    try {
        // í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ ì¡°íšŒ
        const res = await fetch(`${API}/daily-logs/student/${selectedStudent.id}`);
        const logs = await res.json();
        const targetLog = logs.find(log => log.date === selectedDate);
        
        const tasksList = document.getElementById("tasksList");
        const tasksListTitle = document.getElementById("tasksListTitle");
        tasksList.innerHTML = "";
        
        // ì œëª© ì—…ë°ì´íŠ¸
        const dateObj = new Date(selectedDate);
        const today = new Date().toISOString().slice(0, 10);
        if (selectedDate === today) {
            tasksListTitle.textContent = "ì˜¤ëŠ˜ í•  ì¼ ëª©ë¡";
        } else {
            const dateStr = `${dateObj.getFullYear()}ë…„ ${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼ í•  ì¼ ëª©ë¡`;
            tasksListTitle.textContent = dateStr;
        }
        
        if (targetLog && targetLog.tasks && targetLog.tasks.length > 0) {
            targetLog.tasks.forEach(task => {
                const li = document.createElement("li");
                li.className = "task-item";
                li.style.marginBottom = "0.75rem";
                li.id = `task-item-${task.id}`;
                
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 0.5rem;">
                        <div style="flex: 1;">
                            <div class="checkbox-group">
                                <label>
                                    <input
                                        type="checkbox"
                                        ${task.grading_done ? "checked" : ""}
                                        onchange="updateTask(${task.id}, 'grading_done', this.checked)"
                                    />
                                    ì±„ì 
                                </label>
                                <label>
                                    <input
                                        type="checkbox"
                                        ${task.review_done ? "checked" : ""}
                                        onchange="updateTask(${task.id}, 'review_done', this.checked)"
                                    />
                                    ì˜¤ë‹µ
                                </label>
                                ${task.is_done ? '<strong style="color: var(--secondary-color);">âœ… ì™„ë£Œ</strong>' : ''}
                            </div>
                            <div class="task-content" id="task-content-${task.id}" style="margin-top: 0.5rem;">${task.content}</div>
                        </div>
                        <div style="display: flex; gap: 0.25rem;">
                            <button onclick="editTask(${task.id}, '${task.content.replace(/'/g, "\\'")}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">ìˆ˜ì •</button>
                            <button onclick="deleteTask(${task.id})" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: var(--danger-color); color: white; border: none; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                tasksList.appendChild(li);
            });
        } else {
            tasksList.innerHTML = '<li class="empty-state">í•´ë‹¹ ë‚ ì§œì˜ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</li>';
        }
    } catch (error) {
        console.error("í•  ì¼ ë¡œë“œ ì‹¤íŒ¨:", error);
    }
}

// =========================
// í•  ì¼ ì¶”ê°€
// =========================
async function addTasks() {
    if (!selectedStudent) {
        alert("âš ï¸ í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }
    
    const taskInput = document.getElementById("taskInput");
    const taskDateInput = document.getElementById("taskDate");
    const tasksText = taskInput.value.trim();
    
    if (!tasksText) {
        alert("âš ï¸ í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }
    
    if (!taskDateInput || !taskDateInput.value) {
        alert("âš ï¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }

    const tasks = tasksText
        .split("\n")
        .map(t => t.trim())
        .filter(t => t !== "")
        .map(t => ({ content: t }));

    if (tasks.length === 0) {
        alert("âš ï¸ í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    const selectedDate = taskDateInput.value;

    try {
        // í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ ì¡°íšŒ
        const logsRes = await fetch(`${API}/daily-logs/student/${selectedStudent.id}`);
        const logs = await logsRes.json();
        const existingLog = logs.find(log => log.date === selectedDate);

        // ì¼ì§€ê°€ ìˆìœ¼ë©´ í•  ì¼ ì¶”ê°€, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        // ë°±ì—”ë“œì—ì„œ ì¼ì§€ê°€ ì´ë¯¸ ìˆìœ¼ë©´ í•  ì¼ë§Œ ì¶”ê°€í•˜ë„ë¡ ìˆ˜ì •ë¨
        const response = await fetch(`${API}/daily-logs/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                student_id: selectedStudent.id,
                date: selectedDate,
                tasks: tasks,
                teacher_note: "", // í•  ì¼ë§Œ ì¶”ê°€í•  ë•ŒëŠ” ë¹ˆ ë¬¸ìì—´
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText);
        }

        taskInput.value = "";
        loadTasksForDate(); // ì„ íƒëœ ë‚ ì§œì˜ í•  ì¼ ë‹¤ì‹œ ë¡œë“œ
        alert("í•  ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } catch (error) {
        console.error("í•  ì¼ ì¶”ê°€ ì˜¤ë¥˜:", error);
        alert("í•  ì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
    }
}

// =========================
// ë‚ ì§œë³„ ì¼ì§€ ë¡œë“œ
// =========================
async function loadLogForDate() {
    if (!selectedStudent) return;
    
    const logDate = document.getElementById("logDate").value;
    if (!logDate) return;

    try {
        // í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ ì¡°íšŒ
        const res = await fetch(`${API}/daily-logs/student/${selectedStudent.id}`);
        const logs = await res.json();
        const targetLog = logs.find(log => log.date === logDate);

        // í•  ì¼ ëª©ë¡ í‘œì‹œ
        const logTasksList = document.getElementById("logTasksList");
        if (targetLog && targetLog.tasks && targetLog.tasks.length > 0) {
            logTasksList.innerHTML = targetLog.tasks.map(task => `
                <div class="task-item" style="margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                        ${task.grading_done ? '<span style="color: var(--secondary-color);">âœ“ ì±„ì </span>' : ''}
                        ${task.review_done ? '<span style="color: var(--primary-color);">âœ“ ì˜¤ë‹µ</span>' : ''}
                        ${task.is_done ? '<strong style="color: var(--secondary-color);">âœ… ì™„ë£Œ</strong>' : '<span style="color: var(--text-secondary);">â³ ì§„í–‰ì¤‘</span>'}
                    </div>
                    <div style="color: var(--text-primary);">${task.content}</div>
                </div>
            `).join("");
        } else {
            logTasksList.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>';
        }

        // ì¶œì„ í˜„í™© ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
        const attendanceRes = await fetch(`${API}/attendance/student/${selectedStudent.id}`);
        const attendanceRecords = await attendanceRes.json();
        const dateAttendance = attendanceRecords.find(r => r.date === logDate);
        
        if (dateAttendance) {
            // ì¶œì„ ìƒíƒœ ë§¤í•‘
            let attendanceStatus = "";
            if (dateAttendance.status === "present") {
                attendanceStatus = "ì¶œì„";
            } else if (dateAttendance.status === "absent") {
                attendanceStatus = "ê²°ì„";
            }
            document.getElementById("logAttendanceStatus").value = attendanceStatus;
            document.getElementById("logAttendanceStatus").disabled = false;
        } else {
            document.getElementById("logAttendanceStatus").value = "";
            document.getElementById("logAttendanceStatus").disabled = false;
        }

        // ì¼ì§€ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
        if (targetLog) {
            document.getElementById("teacherNote").value = targetLog.teacher_note || "";
            document.getElementById("absenceReason").value = targetLog.absence_reason || "";
            document.getElementById("followUpAction").value = targetLog.follow_up_action || "";
            document.getElementById("makeupClassNote").value = targetLog.makeup_class_note || "";
            document.getElementById("examResult").value = targetLog.exam_result || "";
        } else {
            // ì¼ì§€ê°€ ì—†ìœ¼ë©´ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById("teacherNote").value = "";
            document.getElementById("absenceReason").value = "";
            document.getElementById("followUpAction").value = "";
            document.getElementById("makeupClassNote").value = "";
            document.getElementById("examResult").value = "";
        }
    } catch (error) {
        console.error("ì¼ì§€ ë¡œë“œ ì‹¤íŒ¨:", error);
    }
}

// =========================
// ì¼ì§€ ìƒì„±/ì—…ë°ì´íŠ¸
// =========================
async function createDailyLog() {
    if (!selectedStudent) {
        alert("âš ï¸ í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }
    
    const logDate = document.getElementById("logDate").value;
    if (!logDate) {
        alert("âš ï¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }

    try {
        // í•´ë‹¹ ë‚ ì§œì˜ í•  ì¼ ê°€ì ¸ì˜¤ê¸°
        const logsRes = await fetch(`${API}/daily-logs/student/${selectedStudent.id}`);
        const logs = await logsRes.json();
        const existingLog = logs.find(log => log.date === logDate);
        
        // ê¸°ì¡´ í•  ì¼ ìœ ì§€ (í•  ì¼ ê´€ë¦¬ íƒ­ì—ì„œ ì¶”ê°€í•œ í•  ì¼ë“¤)
        const existingTasks = existingLog && existingLog.tasks ? existingLog.tasks.map(t => ({ content: t.content })) : [];

        const response = await fetch(`${API}/daily-logs/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                student_id: selectedStudent.id,
                date: logDate,
                tasks: existingTasks, // ê¸°ì¡´ í•  ì¼ ìœ ì§€
                teacher_note: document.getElementById("teacherNote").value,
                attendance_status: document.getElementById("logAttendanceStatus").value,
                absence_reason: document.getElementById("absenceReason").value,
                follow_up_action: document.getElementById("followUpAction").value,
                makeup_class_note: document.getElementById("makeupClassNote").value,
                exam_result: document.getElementById("examResult").value,
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            if (errorText.includes("ì´ë¯¸ ì˜¤ëŠ˜ ì¼ì§€ê°€ ìˆìŒ") || errorText.includes("ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€")) {
                alert("âš ï¸ ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ê°€ ìˆìŠµë‹ˆë‹¤.\nì¼ì§€ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë°±ì—”ë“œ ì œí•œ)");
                return;
            }
            throw new Error(errorText);
        }

        alert("ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        loadDailyLogs();
        loadTasksForDate(); // í•  ì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
        loadLogForDate(); // í˜„ì¬ ì„ íƒëœ ë‚ ì§œì˜ ì¼ì§€ ë‹¤ì‹œ ë¡œë“œ
    } catch (error) {
        console.error("ì¼ì§€ ì €ì¥ ì˜¤ë¥˜:", error);
        alert("ì¼ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
    }
}

// =========================
// ì¼ì§€ ì¡°íšŒ
// =========================
async function loadDailyLogs() {
    if (!selectedStudent) return;
    
    const res = await fetch(`${API}/daily-logs/student/${selectedStudent.id}`);
    const logs = await res.json();
    const list = document.getElementById("logList");
    list.innerHTML = "";

    if (logs.length === 0) {
        list.innerHTML = '<li class="empty-state">ì‘ì„±ëœ ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</li>';
        return;
    }

    logs.forEach(log => {
        const li = document.createElement("li");
        li.className = "log-item";

        const tasksHtml = log.tasks.map(t => `
            <div class="task-item">
                <div class="checkbox-group">
                    <label>
                        <input
                            type="checkbox"
                            ${t.grading_done ? "checked" : ""}
                            onchange="updateTask(${t.id}, 'grading_done', this.checked)"
                        />
                        ì±„ì 
                    </label>
                    <label>
                        <input
                            type="checkbox"
                            ${t.review_done ? "checked" : ""}
                            onchange="updateTask(${t.id}, 'review_done', this.checked)"
                        />
                        ì˜¤ë‹µ
                    </label>
                    ${t.is_done ? '<strong style="color: var(--secondary-color);">âœ… ì™„ë£Œ</strong>' : ''}
                </div>
                <div class="task-content">${t.content}</div>
            </div>
        `).join("");

        const memoHtml = log.teacher_note ? `<p style="margin: 0.75rem 0; padding: 0.75rem; background: white; border-radius: 6px;"><strong>ë©”ëª¨:</strong> ${log.teacher_note}</p>` : '';
        const attendanceHtml = log.attendance_status ? `<p style="margin: 0.5rem 0; color: var(--text-secondary);"><strong>ì¶œê²°:</strong> ${log.attendance_status}</p>` : '';
        
        li.innerHTML = `
            <div class="log-date">${log.date}</div>
            ${attendanceHtml}
            ${tasksHtml}
            ${memoHtml}
            <button class="btn-secondary" onclick="shareKakao(${log.id})" style="margin-top: 0.75rem; width: 100%;">
              ğŸ“¤ í•™ë¶€ëª¨ì—ê²Œ ê³µìœ 
            </button>
        `;

        list.appendChild(li);
    });
}

async function updateTask(taskId, field, value) {
    try {
        await fetch(`${API}/daily-tasks/${taskId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                [field]: value
            })
        });

        // í•  ì¼ ëª©ë¡ê³¼ ì¼ì§€ ëª©ë¡ ëª¨ë‘ ì—…ë°ì´íŠ¸
        loadTasksForDate(); // í˜„ì¬ ì„ íƒëœ ë‚ ì§œì˜ í•  ì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
        loadDailyLogs();
        
        // ì¼ì§€ ê´€ë¦¬ íƒ­ì—ì„œ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ë„ ì—…ë°ì´íŠ¸
        const logDate = document.getElementById("logDate").value;
        if (logDate) {
            loadLogForDate();
        }
    } catch (error) {
        console.error("í•  ì¼ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error);
        alert("í•  ì¼ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

// =========================
// í•  ì¼ ìˆ˜ì •
// =========================
function editTask(taskId, currentContent) {
    const contentDiv = document.getElementById(`task-content-${taskId}`);
    if (!contentDiv) return;
    
    const currentText = currentContent || contentDiv.textContent;
    
    // ì¸ë¼ì¸ í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜
    contentDiv.innerHTML = `
        <input type="text" id="edit-task-input-${taskId}" value="${currentText.replace(/"/g, '&quot;')}" 
               style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.875rem;" />
        <div style="display: flex; gap: 0.25rem; margin-top: 0.5rem;">
            <button onclick="saveTaskEdit(${taskId})" style="padding: 0.25rem 0.75rem; font-size: 0.75rem; background: var(--secondary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">ì €ì¥</button>
            <button onclick="cancelTaskEdit(${taskId}, '${currentText.replace(/'/g, "\\'")}')" style="padding: 0.25rem 0.75rem; font-size: 0.75rem; background: var(--text-secondary); color: white; border: none; border-radius: 4px; cursor: pointer;">ì·¨ì†Œ</button>
        </div>
    `;
    
    // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
    const input = document.getElementById(`edit-task-input-${taskId}`);
    if (input) {
        input.focus();
        input.select();
    }
}

async function saveTaskEdit(taskId) {
    const input = document.getElementById(`edit-task-input-${taskId}`);
    if (!input) return;
    
    const newContent = input.value.trim();
    if (!newContent) {
        alert("í•  ì¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }
    
    try {
        await fetch(`${API}/daily-tasks/${taskId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                content: newContent
            })
        });
        
        // í•  ì¼ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
        loadTasksForDate();
        loadDailyLogs();
        
        // ì¼ì§€ ê´€ë¦¬ íƒ­ì—ì„œ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ë„ ì—…ë°ì´íŠ¸
        const logDate = document.getElementById("logDate").value;
        if (logDate) {
            loadLogForDate();
        }
    } catch (error) {
        console.error("í•  ì¼ ìˆ˜ì • ì‹¤íŒ¨:", error);
        alert("í•  ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

function cancelTaskEdit(taskId, originalContent) {
    const contentDiv = document.getElementById(`task-content-${taskId}`);
    if (!contentDiv) return;
    
    contentDiv.textContent = originalContent;
}

// =========================
// í•  ì¼ ì‚­ì œ
// =========================
async function deleteTask(taskId) {
    if (!confirm("ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        return;
    }
    
    try {
        const response = await fetch(`${API}/daily-tasks/${taskId}`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" }
        });
        
        if (!response.ok) {
            throw new Error("ì‚­ì œ ì‹¤íŒ¨");
        }
        
        // í•  ì¼ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
        loadTasksForDate();
        loadDailyLogs();
        
        // ì¼ì§€ ê´€ë¦¬ íƒ­ì—ì„œ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì¼ì§€ë„ ì—…ë°ì´íŠ¸
        const logDate = document.getElementById("logDate").value;
        if (logDate) {
            loadLogForDate();
        }
        
        alert("í•  ì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch (error) {
        console.error("í•  ì¼ ì‚­ì œ ì‹¤íŒ¨:", error);
        alert("í•  ì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

// =========================
// ë¯¸ì¶œì„ í•™ìƒ ì¡°íšŒ
// =========================
let absentStudents = [];

async function loadAbsentStudents() {
    const res = await fetch(`${API}/attendance/absent/today`);
    const data = await res.json();

    absentStudents = data;
    const list = document.getElementById("absentList");
    list.innerHTML = "";

    if (data.length === 0) {
        list.innerHTML = '<li class="empty-state">ğŸ‰ ì˜¤ëŠ˜ ëª¨ë‘ ì¶œì„ ì™„ë£Œ!</li>';
        return;
    }

    data.forEach(s => {
        const li = document.createElement("li");
        li.className = "attendance-item late-or-absent";
        li.innerHTML = `
            <label style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; width: 100%;">
                <input type="checkbox" data-id="${s.student_id}" style="width: auto; margin: 0;" />
                <strong>${s.name}</strong>
            </label>
        `;
        list.appendChild(li);
    });
}

function sendSelectedSMS() {
    const checked = document.querySelectorAll(
        "#absentList input[type=checkbox]:checked"
    );

    if (checked.length === 0) {
        alert("ì„ íƒëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const names = [];
    checked.forEach(cb => {
        const student = absentStudents.find(
            s => s.student_id == cb.dataset.id
        );
        if (student) {
            names.push(student.name);
        }
    });

    alert(`ë¬¸ì ë°œì†¡ ì™„ë£Œ (ì„ì‹œ)\n\nëŒ€ìƒ:\n- ${names.join("\n- ")}`);
}

// =========================
// ìš”ì¼ë³„ ë“±ì› ì‹œê°„ ì €ì¥
// =========================
async function loadStudentSchedules() {
    if (!selectedStudent) return;
    
    const res = await fetch(`${API}/students/${selectedStudent.id}/schedules/`);
    const schedules = await res.json();

    const map = {};
    schedules.forEach(s => {
        map[s.weekday] = s.expected_time;
    });

    const list = document.getElementById("scheduleList");
    list.innerHTML = "";

    WEEKDAYS.forEach(d => {
        const li = document.createElement("li");
        li.className = "schedule-item";

        li.innerHTML = `
            <label>${d.label}ìš”ì¼</label>
            <input
                type="time"
                value="${map[d.value] || ""}"
                onchange="saveSchedule(${d.value}, this.value)"
                placeholder="ì‹œê°„ ì„ íƒ"
            />
        `;

        list.appendChild(li);
    });
}

async function saveSchedule(weekday, time) {
    if (!time || !selectedStudent) return;

    const response = await fetch(`${API}/students/${selectedStudent.id}/schedules/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            weekday: weekday,
            expected_time: time
        })
    });
    
    if (response.ok) {
        // ë“±ì› ì‹œê°„ ì €ì¥ í›„ ì¶œì„ ì •ë³´ ì—…ë°ì´íŠ¸
        await loadStudentAttendance();
        await loadAttendanceToday();
        await loadAttendanceOverview();
    }
}

let currentShareUrl = null;

async function shareKakao(logId) {
    try {
        // ì¼ì§€ ìƒˆë¡œê³ ì¹¨ (ìµœì‹  ë°ì´í„° ë°˜ì˜)
        if (selectedStudent) {
            await loadDailyLogs();
        }

        // ì´ë¯¸ì§€ ìƒì„± ìš”ì²­
        const res = await fetch(`${API}/daily-logs/${logId}/image`, {
            method: "POST"
        });
        
        if (!res.ok) {
            throw new Error(`ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨: ${res.status}`);
        }
        
        const data = await res.json();

        // ì´ë¯¸ì§€ URL ìƒì„± (API ì„œë²„ì˜ ì´ë¯¸ì§€ íŒŒì¼ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©)
        // ë°±ì—”ë“œì—ì„œ ë°˜í™˜ëœ image_urlì€ "/static/reports/log_1.png" í˜•ì‹
        // ì´ë¥¼ API ì„œë²„ URLê³¼ ê²°í•©í•˜ê±°ë‚˜ ì§ì ‘ ì´ë¯¸ì§€ íŒŒì¼ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
        if (data.image_url) {
            // image_urlì´ ìƒëŒ€ ê²½ë¡œì¸ ê²½ìš° API ì„œë²„ì™€ ê²°í•©
            if (data.image_url.startsWith('/')) {
                currentShareUrl = `${API}${data.image_url}?t=${Date.now()}`;
            } else {
                currentShareUrl = `${API}/${data.image_url}?t=${Date.now()}`;
            }
        } else {
            // image_urlì´ ì—†ìœ¼ë©´ ì´ë¯¸ì§€ íŒŒì¼ ì—”ë“œí¬ì¸íŠ¸ ì§ì ‘ ì‚¬ìš©
            currentShareUrl = `${API}/daily-logs/${logId}/image-file?t=${Date.now()}`;
        }

        document.getElementById("shareImage").src = currentShareUrl;
        document.getElementById("shareModal").classList.remove("hidden");
        
        // ì´ë¯¸ì§€ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬
        document.getElementById("shareImage").onerror = function() {
            alert("ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
        };
    } catch (error) {
        console.error("ì´ë¯¸ì§€ ê³µìœ  ì˜¤ë¥˜:", error);
        alert("ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
    }
}

function closeShareModal() {
    document.getElementById("shareModal").classList.add("hidden");
}

// ì´ˆê¸° ì‹¤í–‰ì€ initializeApp()ì—ì„œ ì²˜ë¦¬

// ì´ˆê¸° ë¡œë“œ: ì˜¤ëŠ˜ ë‚ ì§œì˜ ì¼ì§€ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (í•™ìƒ ì„ íƒ í›„)
function loadInitialLogData() {
    if (selectedStudent) {
        loadLogForDate();
    }
}

// =========================
// ìƒë‹´ ê´€ë¦¬ ê´€ë ¨
// =========================
let allConsultations = [];
let currentCalendarDate = new Date();
let selectedConsultationDate = null;

// ìƒë‹´ ëª©ë¡ ë¡œë“œ
async function loadConsultations() {
    try {
        const res = await fetch(`${API}/consultations/`);
        allConsultations = await res.json();
        renderCalendar();
        // ì „ì²´ ìƒë‹´ ëª©ë¡ì„ ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ í‘œì‹œ
        renderConsultationList();
    } catch (error) {
        console.error("ìƒë‹´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", error);
    }
}

// ìº˜ë¦°ë” ë Œë”ë§
function renderCalendar() {
    const calendarDiv = document.getElementById("consultationCalendar");
    const monthTitle = document.getElementById("calendarMonth");
    
    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    
    monthTitle.textContent = `${year}ë…„ ${month + 1}ì›”`;
    
    // í•´ë‹¹ ì›”ì˜ ì²« ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const firstDayOfWeek = firstDay.getDay(); // 0=ì¼ìš”ì¼
    const daysInMonth = lastDay.getDate();
    
    // ì´ì „ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ë“¤
    const prevMonthLastDay = new Date(year, month, 0).getDate();
    
    // ìš”ì¼ í—¤ë” í–‰
    let calendarHTML = `
        <div class="calendar-header">ì¼</div>
        <div class="calendar-header">ì›”</div>
        <div class="calendar-header">í™”</div>
        <div class="calendar-header">ìˆ˜</div>
        <div class="calendar-header">ëª©</div>
        <div class="calendar-header">ê¸ˆ</div>
        <div class="calendar-header">í† </div>
    `;
    
    // ì´ì „ ë‹¬ì˜ ë‚ ë“¤ (ì²« ì£¼ì˜ ì•ë¶€ë¶„)
    for (let i = firstDayOfWeek - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        const prevMonth = month === 0 ? 11 : month - 1;
        const prevYear = month === 0 ? year - 1 : year;
        const dateStr = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        calendarHTML += `<div class="calendar-day other-month" onclick="selectDate('${dateStr}')">${day}</div>`;
    }
    
    // í˜„ì¬ ë‹¬ì˜ ë‚ ë“¤
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const isToday = date.getTime() === today.getTime();
        const isSelected = selectedConsultationDate === dateStr;
        
        // í•´ë‹¹ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡
        const dayConsultations = allConsultations.filter(c => c.date === dateStr);
        
        let dayClass = "calendar-day";
        if (isToday) dayClass += " today";
        if (isSelected) dayClass += " selected";
        
        // ìƒë‹´ ëª©ë¡ HTML ìƒì„± (í•™ìƒ ì´ë¦„ìœ¼ë¡œ í‘œì‹œ)
        let consultationsHTML = '';
        if (dayConsultations.length > 0) {
            consultationsHTML = dayConsultations.map(c => {
                const name = c.student_name || 'í•™ìƒ';
                return `<div class="calendar-day-events" title="${name} ìƒë‹´">${name} ìƒë‹´</div>`;
            }).join('');
        }
        
        calendarHTML += `
            <div class="${dayClass}" onclick="selectDate('${dateStr}')">
                <div class="calendar-day-number">${day}</div>
                ${consultationsHTML}
            </div>
        `;
    }
    
    // ë‹¤ìŒ ë‹¬ì˜ ë‚ ë“¤ (ë§ˆì§€ë§‰ ì£¼ì˜ ë’·ë¶€ë¶„ - ì´ 6ì£¼ = 42ê°œ ì…€ë¡œ ê³ ì •)
    const totalCells = 42; // 6ì£¼ * 7ì¼
    const usedCells = firstDayOfWeek + daysInMonth;
    const nextMonthDays = Math.max(0, totalCells - usedCells);
    
    for (let day = 1; day <= nextMonthDays; day++) {
        const nextMonth = month + 1;
        const nextYear = month === 11 ? year + 1 : year;
        const dateStr = `${nextYear}-${String(nextMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        calendarHTML += `<div class="calendar-day other-month" onclick="selectDate('${dateStr}')">${day}</div>`;
    }
    
    calendarDiv.innerHTML = calendarHTML;
}

// ì›” ë³€ê²½
function changeMonth(delta) {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
    renderCalendar();
}

// ë‚ ì§œ ì„ íƒ
function selectDate(dateStr) {
    selectedConsultationDate = dateStr;
    renderCalendar();
    // ì„ íƒí•œ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ í‘œì‹œ
    renderConsultationListForDate(dateStr);
}

// íŠ¹ì • ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ ë Œë”ë§
function renderConsultationListForDate(dateStr) {
    const list = document.getElementById("consultationList");
    const title = document.getElementById("selectedDateTitle");
    
    const date = new Date(dateStr);
    const dateDisplay = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
    title.textContent = `ğŸ“‹ ${dateDisplay} ìƒë‹´ ëª©ë¡`;
    
    list.innerHTML = "";
    
    // í•´ë‹¹ ë‚ ì§œì˜ ëª¨ë“  ìƒë‹´ (ìƒíƒœ ë¬´ê´€)
    const dateConsultations = allConsultations.filter(c => c.date === dateStr);
    
    // ì‹œê°„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    const sortedConsultations = [...dateConsultations].sort((a, b) => {
        const timeA = a.time || '00:00';
        const timeB = b.time || '00:00';
        return timeA.localeCompare(timeB);
    });
    
    // ìƒë‹´ ì¶”ê°€ ë²„íŠ¼
    const addButton = document.createElement('button');
    addButton.className = 'btn-primary';
    addButton.style.cssText = 'width: 100%; margin-bottom: 1rem; padding: 0.5rem;';
    addButton.textContent = `â• ${dateDisplay} ìƒë‹´ ì¶”ê°€`;
    addButton.onclick = () => {
        selectedConsultationDate = dateStr;
        openConsultationModal();
    };
    list.appendChild(addButton);
    
    if (sortedConsultations.length === 0) {
        const emptyLi = document.createElement('li');
        emptyLi.className = 'empty-state';
        emptyLi.textContent = 'í•´ë‹¹ ë‚ ì§œì˜ ìƒë‹´ì´ ì—†ìŠµë‹ˆë‹¤';
        list.appendChild(emptyLi);
        return;
    }
    
    
    // ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ ë Œë”ë§
    sortedConsultations.forEach(consultation => {
        const li = document.createElement("li");
        li.className = `consultation-item ${consultation.status}`;
        
        let statusText = '';
        let statusColor = '';
        if (consultation.status === 'scheduled') {
            statusText = 'ì˜ˆì •';
            statusColor = 'var(--primary-color)';
        } else if (consultation.status === 'completed') {
            statusText = 'ì™„ë£Œ';
            statusColor = 'var(--secondary-color)';
        } else if (consultation.status === 'cancelled') {
            statusText = 'ì·¨ì†Œ';
            statusColor = 'var(--danger-color)';
        }
        
        const date = new Date(consultation.date);
        const dateStr = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
        
        li.innerHTML = `
            <div style="margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.375rem;">
                    <div style="flex: 1; min-width: 0;">
                        <strong style="font-size: 0.875rem;">${consultation.student_name}</strong> 
                        <span style="font-size: 0.75rem; color: var(--text-secondary);">(${consultation.student_grade})</span>
                        ${consultation.parent_name ? `<div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.125rem;">${consultation.parent_name}</div>` : ''}
                    </div>
                    <span style="font-size: 0.7rem; color: ${statusColor}; font-weight: 600; white-space: nowrap; margin-left: 0.5rem;">${statusText}</span>
                </div>
                <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.375rem;">
                    ${dateStr} ${consultation.time}
                </div>
                ${consultation.content ? `<div style="margin-bottom: 0.375rem; padding: 0.375rem; background: white; border-radius: 4px; font-size: 0.75rem; line-height: 1.4; word-break: break-word;">${consultation.content}</div>` : ''}
                ${consultation.notes ? `<div style="padding: 0.375rem; background: #f9fafb; border-radius: 4px; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.375rem; word-break: break-word;">ğŸ“ ${consultation.notes}</div>` : ''}
                <div style="display: flex; gap: 0.25rem; margin-top: 0.5rem; flex-wrap: wrap;">
                    ${consultation.status !== 'completed' ? `<button onclick="completeConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--secondary-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ì™„ë£Œ</button>` : ''}
                    <button onclick="editConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--primary-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ìˆ˜ì •</button>
                    <button onclick="deleteConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--danger-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ì‚­ì œ</button>
                </div>
            </div>
        `;
        list.appendChild(li);
    });
}

// ì˜ˆì • ìƒë‹´ ëª©ë¡ ë Œë”ë§ (ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ)
function renderConsultationList() {
    const list = document.getElementById("consultationList");
    const title = document.getElementById("selectedDateTitle");
    
    title.textContent = `ğŸ“‹ ì˜ˆì • ìƒë‹´ ëª©ë¡`;
    
    list.innerHTML = "";
    
    // ì˜ˆì • ìƒíƒœì¸ ìƒë‹´ë§Œ í•„í„°ë§
    const scheduledConsultations = allConsultations.filter(c => c.status === 'scheduled');
    
    // ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    const sortedConsultations = [...scheduledConsultations].sort((a, b) => {
        const dateA = new Date(a.date + 'T' + a.time);
        const dateB = new Date(b.date + 'T' + b.time);
        return dateA - dateB;
    });
    
    if (sortedConsultations.length === 0) {
        list.innerHTML = '<li class="empty-state">ì˜ˆì •ëœ ìƒë‹´ì´ ì—†ìŠµë‹ˆë‹¤</li>';
        return;
    }
    
    sortedConsultations.forEach(consultation => {
        const li = document.createElement("li");
        li.className = `consultation-item ${consultation.status}`;
        
        let statusText = '';
        let statusColor = '';
        if (consultation.status === 'scheduled') {
            statusText = 'ì˜ˆì •';
            statusColor = 'var(--primary-color)';
        } else if (consultation.status === 'completed') {
            statusText = 'ì™„ë£Œ';
            statusColor = 'var(--secondary-color)';
        } else if (consultation.status === 'cancelled') {
            statusText = 'ì·¨ì†Œ';
            statusColor = 'var(--danger-color)';
        }
        
        const date = new Date(consultation.date);
        const dateStr = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
        
        li.innerHTML = `
            <div style="margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.375rem;">
                    <div style="flex: 1; min-width: 0;">
                        <strong style="font-size: 0.875rem;">${consultation.student_name}</strong> 
                        <span style="font-size: 0.75rem; color: var(--text-secondary);">(${consultation.student_grade})</span>
                        ${consultation.parent_name ? `<div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.125rem;">${consultation.parent_name}</div>` : ''}
                    </div>
                    <span style="font-size: 0.7rem; color: ${statusColor}; font-weight: 600; white-space: nowrap; margin-left: 0.5rem;">${statusText}</span>
                </div>
                <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.375rem;">
                    ${dateStr} ${consultation.time}
                </div>
                ${consultation.content ? `<div style="margin-bottom: 0.375rem; padding: 0.375rem; background: white; border-radius: 4px; font-size: 0.75rem; line-height: 1.4; word-break: break-word;">${consultation.content}</div>` : ''}
                ${consultation.notes ? `<div style="padding: 0.375rem; background: #f9fafb; border-radius: 4px; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.375rem; word-break: break-word;">ğŸ“ ${consultation.notes}</div>` : ''}
                <div style="display: flex; gap: 0.25rem; margin-top: 0.5rem; flex-wrap: wrap;">
                    ${consultation.status !== 'completed' ? `<button onclick="completeConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--secondary-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ì™„ë£Œ</button>` : ''}
                    <button onclick="editConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--primary-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ìˆ˜ì •</button>
                    <button onclick="deleteConsultation(${consultation.id})" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; background: var(--danger-color); color: white; border: none; border-radius: 3px; cursor: pointer;">ì‚­ì œ</button>
                </div>
            </div>
        `;
        list.appendChild(li);
    });
    
    // ì „ì²´ ë³´ê¸°ì—ì„œëŠ” selectedConsultationDate ì´ˆê¸°í™”
    selectedConsultationDate = null;
}

// ìƒë‹´ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
function openConsultationModal(consultationId = null) {
    const modal = document.getElementById("consultationModal");
    modal.classList.remove("hidden");
    
    if (consultationId) {
        // ìˆ˜ì • ëª¨ë“œ
        loadConsultationForEdit(consultationId);
    } else {
        // ë“±ë¡ ëª¨ë“œ
        document.getElementById("consultationFormTitle").textContent = "â• ìƒë‹´ ë“±ë¡";
        document.getElementById("consultationForm").reset();
        document.getElementById("consultationForm").dataset.mode = "create";
        delete document.getElementById("consultationForm").dataset.consultationId;
        document.getElementById("consultationStudentName").value = "";
        document.getElementById("consultationStudentGrade").value = "";
        if (selectedConsultationDate) {
            document.getElementById("consultationDate").value = selectedConsultationDate;
        } else {
            document.getElementById("consultationDate").value = new Date().toISOString().slice(0, 10);
        }
        document.getElementById("consultationTime").value = "14:00";
    }
}

// ìƒë‹´ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
function closeConsultationModal() {
    document.getElementById("consultationModal").classList.add("hidden");
}

// ìƒë‹´ ë“±ë¡/ìˆ˜ì •
async function saveConsultation() {
    const form = document.getElementById("consultationForm");
    const mode = form.dataset.mode;
    const consultationId = form.dataset.consultationId;
    
    const studentName = document.getElementById("consultationStudentName").value.trim();
    const studentGrade = document.getElementById("consultationStudentGrade").value.trim();
    const date = document.getElementById("consultationDate").value;
    const time = document.getElementById("consultationTime").value;
    const parentName = document.getElementById("consultationParentName").value.trim();
    const content = document.getElementById("consultationContent").value.trim();
    const notes = document.getElementById("consultationNotes").value.trim();
    const status = document.getElementById("consultationStatus").value;
    
    if (!studentName || !studentGrade || !date || !time) {
        alert("í•™ìƒ ì´ë¦„, í•™ë…„, ë‚ ì§œ, ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }
    
    try {
        const url = mode === "edit" 
            ? `${API}/consultations/${consultationId}`
            : `${API}/consultations/`;
        const method = mode === "edit" ? "PUT" : "POST";
        
        const response = await fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                student_name: studentName,
                student_grade: studentGrade,
                date: date,
                time: time,
                parent_name: parentName || null,
                content: content || null,
                notes: notes || null,
                status: status || "scheduled"
            })
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error("ìƒë‹´ ì €ì¥ ì‹¤íŒ¨ ì‘ë‹µ:", errorText);
            throw new Error(errorText || "ìƒë‹´ ì €ì¥ ì‹¤íŒ¨");
        }
        
        closeConsultationModal();
        loadConsultations();
        // ì €ì¥ í›„ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ í‘œì‹œ
        if (selectedConsultationDate) {
            renderConsultationListForDate(selectedConsultationDate);
        } else {
            renderConsultationList();
        }
        renderCalendar();
        alert("ìƒë‹´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } catch (error) {
        console.error("ìƒë‹´ ì €ì¥ ì‹¤íŒ¨:", error);
        const errorMessage = error.message || "ìƒë‹´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        alert(`ìƒë‹´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜ ë‚´ìš©: ${errorMessage}`);
    }
}

// ìƒë‹´ ìˆ˜ì •ì„ ìœ„í•œ ë°ì´í„° ë¡œë“œ
async function loadConsultationForEdit(consultationId) {
    try {
        const res = await fetch(`${API}/consultations/${consultationId}`);
        const consultation = await res.json();
        
        document.getElementById("consultationFormTitle").textContent = "âœï¸ ìƒë‹´ ìˆ˜ì •";
        document.getElementById("consultationForm").dataset.mode = "edit";
        document.getElementById("consultationForm").dataset.consultationId = consultationId;
        document.getElementById("consultationStudentName").value = consultation.student_name || "";
        document.getElementById("consultationStudentGrade").value = consultation.student_grade || "";
        document.getElementById("consultationDate").value = consultation.date;
        document.getElementById("consultationTime").value = consultation.time;
        document.getElementById("consultationParentName").value = consultation.parent_name || "";
        document.getElementById("consultationContent").value = consultation.content || "";
        document.getElementById("consultationNotes").value = consultation.notes || "";
        document.getElementById("consultationStatus").value = consultation.status;
    } catch (error) {
        console.error("ìƒë‹´ ë¡œë“œ ì‹¤íŒ¨:", error);
        alert("ìƒë‹´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

// ìƒë‹´ ìˆ˜ì • (í¸ì˜ í•¨ìˆ˜)
function editConsultation(consultationId) {
    openConsultationModal(consultationId);
}

// ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬
async function completeConsultation(consultationId) {
    try {
        const response = await fetch(`${API}/consultations/${consultationId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                status: "completed"
            })
        });
        
        if (!response.ok) {
            throw new Error("ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨");
        }
        
        loadConsultations();
        // ì™„ë£Œ í›„ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ í‘œì‹œ
        if (selectedConsultationDate) {
            renderConsultationListForDate(selectedConsultationDate);
        } else {
            renderConsultationList();
        }
        renderCalendar();
        alert("ìƒë‹´ì´ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch (error) {
        console.error("ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:", error);
        alert("ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

// ìƒë‹´ ì‚­ì œ
async function deleteConsultation(consultationId) {
    if (!confirm("ì´ ìƒë‹´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        return;
    }
    
    try {
        const response = await fetch(`${API}/consultations/${consultationId}`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" }
        });
        
        if (!response.ok) {
            throw new Error("ì‚­ì œ ì‹¤íŒ¨");
        }
        
        loadConsultations();
        // ì‚­ì œ í›„ ë‚ ì§œê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ìƒë‹´ ëª©ë¡ í‘œì‹œ
        if (selectedConsultationDate) {
            renderConsultationListForDate(selectedConsultationDate);
        } else {
            renderConsultationList();
        }
        renderCalendar();
        alert("ìƒë‹´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch (error) {
        console.error("ìƒë‹´ ì‚­ì œ ì‹¤íŒ¨:", error);
        alert("ìƒë‹´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}
</script>

<!-- ğŸ‘©â€ğŸ“ í•™ìƒ ë“±ë¡ ëª¨ë‹¬ -->
<div id="studentRegisterModal" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="closeStudentRegisterModal()">Ã—</span>
        <h3>ğŸ‘©â€ğŸ“ í•™ìƒ ë“±ë¡</h3>
        <form onsubmit="event.preventDefault(); createStudent();">
            <label>ì´ë¦„ *</label>
            <input id="modalStudentName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required />
            
            <label>í•™ë…„ *</label>
            <input id="modalStudentGrade" type="text" placeholder="ì˜ˆ: ì¤‘2, ê³ 1" required />
            
            <label>ë¶€ëª¨ë‹˜ ì—°ë½ì²˜ (ì„ íƒì‚¬í•­)</label>
            <input id="modalParentPhone" type="tel" placeholder="010-1234-5678" />
            
            <button type="submit" class="btn-primary" style="margin-top: 1rem;">ë“±ë¡í•˜ê¸°</button>
        </form>
    </div>
</div>

<!-- ğŸ“¤ í•™ë¶€ëª¨ ê³µìœ  ëª¨ë‹¬ -->
<div id="shareModal" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="closeShareModal()">Ã—</span>
        <h3>ğŸ“¤ í•™ë¶€ëª¨ì—ê²Œ ë³´ë‚´ê¸°</h3>
        <div style="flex: 1; overflow-y: auto; min-height: 0; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;">
            <img id="shareImage" class="share-image" />
        </div>
        <p class="hint" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); flex-shrink: 0;">
            ğŸ–±ï¸ ì´ë¯¸ì§€ì—ì„œ <b>ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ í´ë¦­ â†’ "ì´ë¯¸ì§€ ë³µì‚¬"</b><br/>
            ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”ì°½ì— ë°”ë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”
        </p>
    </div>
</div>

<!-- ğŸ’¬ ìƒë‹´ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
<div id="consultationModal" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="closeConsultationModal()">Ã—</span>
        <h3 id="consultationFormTitle">â• ìƒë‹´ ë“±ë¡</h3>
        <form id="consultationForm" onsubmit="event.preventDefault(); saveConsultation();">
            <label>í•™ìƒ ì´ë¦„ *</label>
            <input id="consultationStudentName" type="text" placeholder="í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required />
            
            <label>í•™ë…„ *</label>
            <input id="consultationStudentGrade" type="text" placeholder="ì˜ˆ: ì¤‘2, ê³ 1" required />
            
            <label>ë‚ ì§œ *</label>
            <input id="consultationDate" type="date" required />
            
            <label>ì‹œê°„ *</label>
            <input id="consultationTime" type="time" required />
            
            <label>í•™ë¶€ëª¨ ì´ë¦„</label>
            <input id="consultationParentName" type="text" placeholder="í•™ë¶€ëª¨ ì´ë¦„" />
            
            <label>ìƒë‹´ ë‚´ìš©</label>
            <textarea id="consultationContent" placeholder="ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
            
            <label>ë©”ëª¨</label>
            <textarea id="consultationNotes" placeholder="ì¶”ê°€ ë©”ëª¨" rows="3"></textarea>
            
            <label>ìƒíƒœ</label>
            <select id="consultationStatus">
                <option value="scheduled">ì˜ˆì •</option>
                <option value="completed">ì™„ë£Œ</option>
                <option value="cancelled">ì·¨ì†Œ</option>
            </select>
            
            <button type="submit" class="btn-primary" style="margin-top: 1rem;">ì €ì¥</button>
        </form>
    </div>
</div>

</body>
</html>

